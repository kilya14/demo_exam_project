{% extends 'base.html' %}

{% block content %}
<div class="orders-container">
    <h2>Личный кабинет</h2>
    
    <h3>Создать новую заявку</h3>
    <form method="POST" class="order-form">
        {{ order_form.hidden_tag() }}
        <div class="form-group">
            {{ order_form.service_type.label }}
            {{ order_form.service_type(class="form-control") }}
        </div>
        <div class="form-group">
            {{ order_form.service_date.label }}
            {{ order_form.service_date(class="form-control", placeholder="ДД.ММ.ГГГГ") }}
            {% if order_form.service_date.errors %}
                <div class="error">{{ order_form.service_date.errors[0] }}</div>
            {% endif %}
        </div>
        <div class="form-group">
            {{ order_form.payment_method.label }}
            {{ order_form.payment_method(class="form-control") }}
        </div>
        {{ order_form.submit(class="btn btn-primary") }}
    </form>
    
    <h3>Мои заявки</h3>
    {% if orders %}
        <div class="orders-list">
            {% for order in orders %}
            <div class="order-card">
                <p><strong>Заявка №{{ order.id }}</strong></p>
                <p>Тип услуги: {{ order.service_type }}</p>
                <p>Дата услуги: {{ order.service_date }}</p>
                <p>Способ оплаты: {{ order.payment_method }}</p>
                <p>Статус: <span class="status status-{{ order.status }}">{{ order.status }}</span></p>
                <p>Создано: {{ order.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                {% if order.status != 'Новая' and not order.review %}
                    <a href="{{ url_for('main.review', order_id=order.id) }}" class="btn btn-secondary btn-sm">Оставить отзыв</a>
                {% endif %}
                {% if order.review %}
                    <p class="review-badge">✓ Отзыв оставлен (оценка: {{ order.review.rating }}/5)</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p>У вас пока нет заявок</p>
    {% endif %}
</div>
{% endblock %}
